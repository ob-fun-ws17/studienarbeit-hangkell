<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds       #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators   #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-comment">{-|
Module      : Hangman Game Module
Description : Library for handling a __game session__.
Copyright   : &gt;implying
License     : &gt;implying
Maintainer  : Florian Hageneder
Stability   : none
Portability : what?
-}</span><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Game</span><span> </span><span class="hs-special">(</span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Game.html#newGame"><span class="hs-identifier hs-var">newGame</span></a><span class="hs-special">,</span><span> </span><a href="Game.html#makeATurn"><span class="hs-identifier hs-var">makeATurn</span></a><span class="hs-special">,</span><span> </span><a href="Game.html#makeASolve"><span class="hs-identifier hs-var">makeASolve</span></a><span class="hs-special">,</span><span> </span><a href="Game.html#nextPlayerAlive"><span class="hs-identifier hs-var">nextPlayerAlive</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Aeson</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Aeson</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Word.html"><span class="hs-identifier">Word</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="Player.html"><span class="hs-identifier">Player</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-comment">-- | The type to store a game sessions state</span><span>
</span><a name="line-25"></a><span class="hs-keyword">data</span><span> </span><a name="Game"><a href="Game.html#Game"><span class="hs-identifier">Game</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Game"><a href="Game.html#Game"><span class="hs-identifier">Game</span></a></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="gameId"><a href="Game.html#gameId"><span class="hs-identifier">gameId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ ID of the game</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="solution"><a href="Game.html#solution"><span class="hs-identifier">solution</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Word.html#SolutionWord"><span class="hs-identifier hs-type">SolutionWord</span></a><span> </span><span class="hs-comment">-- ^ SolutionWord the game is about</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="players"><a href="Game.html#players"><span class="hs-identifier">players</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ all participating player</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="isRunning"><a href="Game.html#isRunning"><span class="hs-identifier">isRunning</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- ^ wether the game is still running</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="atTurn"><a href="Game.html#atTurn"><span class="hs-identifier">atTurn</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span>  </span><span class="hs-comment">-- ^ the player to make the next turn</span><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="guesses"><a href="Game.html#guesses"><span class="hs-identifier">guesses</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ all chars tried in the past</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-35"></a><span>  </span><a name="local-8214565720323807178"><span class="hs-identifier">toJSON</span></a><span> </span><span class="hs-special">(</span><a href="Game.html#Game"><span class="hs-identifier hs-var">Game</span></a><span> </span><a name="local-6989586621679069505"><a href="#local-6989586621679069505"><span class="hs-identifier">gid</span></a></a><span> </span><a name="local-6989586621679069506"><a href="#local-6989586621679069506"><span class="hs-identifier">solution</span></a></a><span> </span><a name="local-6989586621679069507"><a href="#local-6989586621679069507"><span class="hs-identifier">players</span></a></a><span> </span><a name="local-6989586621679069508"><a href="#local-6989586621679069508"><span class="hs-identifier">running</span></a></a><span> </span><a name="local-6989586621679069509"><a href="#local-6989586621679069509"><span class="hs-identifier">atTurn</span></a></a><span> </span><a name="local-6989586621679069510"><a href="#local-6989586621679069510"><span class="hs-identifier">guesses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">object</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;gameID&quot;</span><span> </span><span class="hs-operator hs-var">.=</span><span> </span><a href="#local-6989586621679069505"><span class="hs-identifier hs-var">gid</span></a><span>
</span><a name="line-37"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;solution&quot;</span><span> </span><span class="hs-operator hs-var">.=</span><span> </span><a href="Word.html#showSolution"><span class="hs-identifier hs-var">showSolution</span></a><span> </span><a href="#local-6989586621679069506"><span class="hs-identifier hs-var">solution</span></a><span>
</span><a name="line-38"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;players&quot;</span><span> </span><span class="hs-operator hs-var">.=</span><span> </span><span class="hs-identifier hs-var">toJSON</span><span> </span><a href="#local-6989586621679069507"><span class="hs-identifier hs-var">players</span></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;atTurn&quot;</span><span> </span><span class="hs-operator hs-var">.=</span><span> </span><span class="hs-identifier hs-var">toJSON</span><span> </span><a href="#local-6989586621679069509"><span class="hs-identifier hs-var">atTurn</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;guesses&quot;</span><span> </span><span class="hs-operator hs-var">.=</span><span> </span><a href="#local-6989586621679069510"><span class="hs-identifier hs-var">guesses</span></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;isRunning&quot;</span><span> </span><span class="hs-operator hs-var">.=</span><span> </span><a href="#local-6989586621679069508"><span class="hs-identifier hs-var">running</span></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">-- | Creates a new game session with an completely unsolved given solutionWord</span><span>
</span><a name="line-45"></a><span class="hs-identifier">newGame</span><span class="hs-glyph">::</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ The ID of this session</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ The goal of this instance of Hangman</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span> </span><span class="hs-comment">-- ^ A valid new game or Nothing</span><span>
</span><a name="line-49"></a><a name="newGame"><a href="Game.html#newGame"><span class="hs-identifier">newGame</span></a></a><span> </span><a name="local-6989586621679069473"><a href="#local-6989586621679069473"><span class="hs-identifier">gid</span></a></a><span> </span><a name="local-6989586621679069474"><a href="#local-6989586621679069474"><span class="hs-identifier">word</span></a></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679069474"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069475"><a href="#local-6989586621679069475"><span class="hs-identifier">solution</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Word.html#createSolutionWord"><span class="hs-identifier hs-var">createSolutionWord</span></a><span> </span><a href="#local-6989586621679069474"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-53"></a><span>        </span><a name="local-6989586621679069476"><a href="#local-6989586621679069476"><span class="hs-identifier">player</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Player.html#newPlayer"><span class="hs-identifier hs-var">newPlayer</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-54"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-var">Game</span></a><span> </span><a href="#local-6989586621679069473"><span class="hs-identifier hs-var">gid</span></a><span> </span><a href="#local-6989586621679069475"><span class="hs-identifier hs-var">solution</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679069476"><span class="hs-identifier hs-var">player</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Word.html#isPlayable"><span class="hs-identifier hs-var">isPlayable</span></a><span> </span><a href="#local-6989586621679069475"><span class="hs-identifier hs-var">solution</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069476"><span class="hs-identifier hs-var">player</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- | Updates the given game session and transists it to the next state</span><span>
</span><a name="line-57"></a><span class="hs-identifier">makeATurn</span><span class="hs-glyph">::</span><span>
</span><a name="line-58"></a><span>  </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span> </span><span class="hs-comment">-- ^ The player who wants to make a turn</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-comment">-- ^ The char to try</span><span>
</span><a name="line-60"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span> </span><span class="hs-comment">-- ^ The game to operate on</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The updated game</span><span>
</span><a name="line-62"></a><a name="makeATurn"><a href="Game.html#makeATurn"><span class="hs-identifier">makeATurn</span></a></a><span> </span><a name="local-6989586621679069477"><a href="#local-6989586621679069477"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679069478"><a href="#local-6989586621679069478"><span class="hs-identifier">char</span></a></a><span> </span><a name="local-6989586621679069479"><a href="#local-6989586621679069479"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Game.html#validTurn"><span class="hs-identifier hs-var">validTurn</span></a><span> </span><a href="#local-6989586621679069477"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679069478"><span class="hs-identifier hs-var">char</span></a><span> </span><a href="#local-6989586621679069479"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069479"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679069478"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">guesses</span><span> </span><a href="#local-6989586621679069479"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Game.html#playersMistake"><span class="hs-identifier hs-var">playersMistake</span></a><span> </span><a href="#local-6989586621679069477"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679069478"><span class="hs-identifier hs-var">char</span></a><span> </span><a href="#local-6989586621679069479"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Word.html#tryChar"><span class="hs-identifier hs-var">tryChar</span></a><span> </span><a href="#local-6989586621679069478"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">solution</span><span> </span><a href="#local-6989586621679069479"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Game.html#playersSuccess"><span class="hs-identifier hs-var">playersSuccess</span></a><span> </span><a href="#local-6989586621679069477"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679069478"><span class="hs-identifier hs-var">char</span></a><span> </span><a href="#local-6989586621679069479"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Game.html#playersMistake"><span class="hs-identifier hs-var">playersMistake</span></a><span> </span><a href="#local-6989586621679069477"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679069478"><span class="hs-identifier hs-var">char</span></a><span> </span><a href="#local-6989586621679069479"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | Updates the given game session and transists it to the next state</span><span>
</span><a name="line-69"></a><span class="hs-identifier">makeASolve</span><span class="hs-glyph">::</span><span>
</span><a name="line-70"></a><span>  </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span> </span><span class="hs-comment">-- ^ The player who wants to solve the game</span><span>
</span><a name="line-71"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ The solution to try</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span> </span><span class="hs-comment">-- ^ The game to operate on</span><span>
</span><a name="line-73"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The updated game</span><span>
</span><a name="line-74"></a><a name="makeASolve"><a href="Game.html#makeASolve"><span class="hs-identifier">makeASolve</span></a></a><span> </span><a name="local-6989586621679069480"><a href="#local-6989586621679069480"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679069481"><a href="#local-6989586621679069481"><span class="hs-identifier">try</span></a></a><span> </span><a name="local-6989586621679069482"><a href="#local-6989586621679069482"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Game.html#validTurn"><span class="hs-identifier hs-var">validTurn</span></a><span> </span><a href="#local-6989586621679069480"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-char">' '</span><span> </span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Word.html#solveWord"><span class="hs-identifier hs-var">solveWord</span></a><span> </span><a href="#local-6989586621679069481"><span class="hs-identifier hs-var">try</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">solution</span><span> </span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Player actually solved game</span><span>
</span><a name="line-77"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069483"><a href="#local-6989586621679069483"><span class="hs-identifier">solved</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Word.html#solveWord"><span class="hs-identifier hs-var">solveWord</span></a><span> </span><a href="#local-6989586621679069481"><span class="hs-identifier hs-var">try</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">solution</span><span> </span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>      </span><span class="hs-special">(</span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">solution</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069483"><span class="hs-identifier hs-var">solved</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">isRunning</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Player did not solve -&gt; now he is dead</span><span>
</span><a name="line-80"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069484"><a href="#local-6989586621679069484"><span class="hs-identifier">newPlayers</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.html#updatePlayers"><span class="hs-identifier hs-var">updatePlayers</span></a><span> </span><span class="hs-special">(</span><a href="Player.html#killPlayer"><span class="hs-identifier hs-var">killPlayer</span></a><span> </span><a href="#local-6989586621679069480"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">players</span><span> </span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>      </span><span class="hs-special">(</span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">players</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069484"><span class="hs-identifier hs-var">newPlayers</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">atTurn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.html#nextPlayerAlive"><span class="hs-identifier hs-var">nextPlayerAlive</span></a><span> </span><a href="#local-6989586621679069482"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">{- | returns the next alive player that is at turn.-}</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- Possibly crashes when no one is alive!!</span><span>
</span><a name="line-85"></a><span class="hs-identifier">nextPlayerAlive</span><span class="hs-glyph">::</span><span>
</span><a name="line-86"></a><span>  </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span>
</span><a name="line-88"></a><a name="nextPlayerAlive"><a href="Game.html#nextPlayerAlive"><span class="hs-identifier">nextPlayerAlive</span></a></a><span> </span><a name="local-6989586621679069485"><a href="#local-6989586621679069485"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069486"><a href="#local-6989586621679069486"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">findIndex</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679069487"><a href="#local-6989586621679069487"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">playerId</span><span> </span><a href="#local-6989586621679069487"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">playerId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">atTurn</span><span> </span><a href="#local-6989586621679069485"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">players</span><span> </span><a href="#local-6989586621679069485"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Player.html#playersAlive"><span class="hs-identifier hs-var">playersAlive</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679069488"><a href="#local-6989586621679069488"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679069489"><a href="#local-6989586621679069489"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069489"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679069488"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitAt</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069486"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">players</span><span> </span><a href="#local-6989586621679069485"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- * Helper ###################################################################</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-identifier">validTurn</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-95"></a><span>  </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span>
</span><a name="line-96"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-98"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-99"></a><a name="validTurn"><a href="Game.html#validTurn"><span class="hs-identifier">validTurn</span></a></a><span> </span><a name="local-6989586621679069490"><a href="#local-6989586621679069490"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069491"><a href="#local-6989586621679069491"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-100"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">isRunning</span><span> </span><a href="#local-6989586621679069491"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- No turn on ended game</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">isAlive</span><span> </span><a href="#local-6989586621679069490"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- player at turn should not be dead</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679069490"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier">atTurn</span><span> </span><a href="#local-6989586621679069491"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- Only the player at turn</span><span>
</span><a name="line-103"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-identifier">trimPlayers</span><span class="hs-glyph">::</span><span>
</span><a name="line-106"></a><span>  </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-107"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-108"></a><span class="hs-comment">--trimPlayers game = game (a, filter (\(_,_,_, alive) -&gt; alive) players game , c, d, e)</span><span>
</span><a name="line-109"></a><a name="trimPlayers"><a href="Game.html#trimPlayers"><span class="hs-identifier">trimPlayers</span></a></a><span> </span><a name="local-6989586621679069492"><a href="#local-6989586621679069492"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-var">Game</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gameId</span><span> </span><a href="#local-6989586621679069492"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">solution</span><span> </span><a href="#local-6989586621679069492"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-identifier">isAlive</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">players</span><span> </span><a href="#local-6989586621679069492"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isRunning</span><span> </span><a href="#local-6989586621679069492"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">atTurn</span><span> </span><a href="#local-6989586621679069492"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">guesses</span><span> </span><a href="#local-6989586621679069492"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">{- | Takes an updated player and replaces its old version in the list.-}</span><span>
</span><a name="line-112"></a><span class="hs-identifier">updatePlayers</span><span class="hs-glyph">::</span><span>
</span><a name="line-113"></a><span>  </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span> </span><span class="hs-comment">-- ^ The updated player</span><span>
</span><a name="line-114"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Old players</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ updated players</span><span>
</span><a name="line-116"></a><a name="updatePlayers"><a href="Game.html#updatePlayers"><span class="hs-identifier">updatePlayers</span></a></a><span> </span><a name="local-6989586621679069493"><a href="#local-6989586621679069493"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679069494"><a href="#local-6989586621679069494"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">playerId</span><span> </span><a href="#local-6989586621679069494"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">playerId</span><span> </span><a href="#local-6989586621679069493"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679069493"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679069494"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-identifier">playersMistake</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-119"></a><span>  </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span>
</span><a name="line-120"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-123"></a><a name="playersMistake"><a href="Game.html#playersMistake"><span class="hs-identifier">playersMistake</span></a></a><span> </span><a name="local-6989586621679069495"><a href="#local-6989586621679069495"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679069496"><a href="#local-6989586621679069496"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679069497"><a href="#local-6989586621679069497"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-124"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069498"><a href="#local-6989586621679069498"><span class="hs-identifier">newPlayers</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.html#updatePlayers"><span class="hs-identifier hs-var">updatePlayers</span></a><span> </span><span class="hs-special">(</span><a href="Player.html#wrongGuess"><span class="hs-identifier hs-var">wrongGuess</span></a><span> </span><a href="#local-6989586621679069495"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">players</span><span> </span><a href="#local-6989586621679069497"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-125"></a><span>      </span><a name="local-6989586621679069499"><a href="#local-6989586621679069499"><span class="hs-identifier">newGuesses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069496"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">guesses</span><span> </span><a href="#local-6989586621679069497"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">guesses</span><span> </span><a href="#local-6989586621679069497"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">guesses</span><span> </span><a href="#local-6989586621679069497"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679069496"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span class="hs-special">;</span><span>
</span><a name="line-126"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069500"><a href="#local-6989586621679069500"><span class="hs-identifier">tmpGame</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069497"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">players</span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069498"><span class="hs-identifier hs-var">newPlayers</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">guesses</span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069499"><span class="hs-identifier hs-var">newGuesses</span></a><span class="hs-special">}</span><span>
</span><a name="line-127"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679069500"><span class="hs-identifier hs-var">tmpGame</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">atTurn</span><span class="hs-glyph">=</span><span> </span><a href="Game.html#nextPlayerAlive"><span class="hs-identifier hs-var">nextPlayerAlive</span></a><span> </span><a href="#local-6989586621679069500"><span class="hs-identifier hs-var">tmpGame</span></a><span class="hs-special">}</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-identifier">playersSuccess</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-130"></a><span> </span><a href="Player.html#Player"><span class="hs-identifier hs-type">Player</span></a><span>
</span><a name="line-131"></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-132"></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-133"></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-134"></a><a name="playersSuccess"><a href="Game.html#playersSuccess"><span class="hs-identifier">playersSuccess</span></a></a><span> </span><a name="local-6989586621679069501"><a href="#local-6989586621679069501"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679069502"><a href="#local-6989586621679069502"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679069503"><a href="#local-6989586621679069503"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069504"><a href="#local-6989586621679069504"><span class="hs-identifier">newSolution</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Word.html#solveChar"><span class="hs-identifier hs-var">solveChar</span></a><span> </span><a href="#local-6989586621679069502"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">solution</span><span> </span><a href="#local-6989586621679069503"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679069503"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">solution</span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069504"><span class="hs-identifier hs-var">newSolution</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">isRunning</span><span class="hs-glyph">=</span><span> </span><a href="Word.html#isPlayable"><span class="hs-identifier hs-var">isPlayable</span></a><span> </span><a href="#local-6989586621679069504"><span class="hs-identifier hs-var">newSolution</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">atTurn</span><span class="hs-glyph">=</span><span> </span><a href="Game.html#nextPlayerAlive"><span class="hs-identifier hs-var">nextPlayerAlive</span></a><span> </span><a href="#local-6989586621679069503"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">guesses</span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">guesses</span><span> </span><a href="#local-6989586621679069503"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679069502"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-137"></a></pre></body></html>